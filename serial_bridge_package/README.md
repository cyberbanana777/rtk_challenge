# ROS2 Serial Bridge Package

–ü–∞–∫–µ—Ç –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏ –º–µ–∂–¥—É ROS2 –∏ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–¥–æ–º–µ—Ç—Ä–∏–∏, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–µ–º.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
serial_bridge_package/
‚îú‚îÄ‚îÄ launch/                          # –§–∞–π–ª—ã –∑–∞–ø—É—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ serial_bringup.launch.py    # –û—Å–Ω–æ–≤–Ω–æ–π launch-—Ñ–∞–π–ª
‚îú‚îÄ‚îÄ rviz/
‚îÇ   ‚îî‚îÄ‚îÄ show_all_stats.rviz         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RViz –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ serial_bridge_package/          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ serial_bridge_node.py       # –ú–æ—Å—Ç –º–µ–∂–¥—É ROS –∏ UART
‚îÇ   ‚îú‚îÄ‚îÄ twist_to_command.py         # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä Twist –≤ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îî‚îÄ‚îÄ feedback_processor.py       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
‚îú‚îÄ‚îÄ package.xml                     # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ setup.py                        # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îî‚îÄ‚îÄ test/                          # –¢–µ—Å—Ç—ã
```

## üöÄ –£–∑–ª—ã (Nodes)

### 1. `serial_bridge_node`
**–ú–æ—Å—Ç –º–µ–∂–¥—É ROS –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ—Ä—Ç–æ–º**
- –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–≤—è–∑—å —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ UART (ESP32 –∏ –¥—Ä.)
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ `$–¥–∞–Ω–Ω—ã–µ#`
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Ä—Ç–∞ (port, baudrate, timeout)

**–¢–æ–ø–∏–∫–∏:**
- –ü—É–±–ª–∏–∫—É–µ—Ç: `low_level/serial/feedback` (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è: `low_level/serial/cmd` (–∫–æ–º–∞–Ω–¥—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)

### 2. `twist_to_command`
**–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π Twist –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `geometry_msgs/Twist` –≤ —Ñ–æ—Ä–º–∞—Ç `$linear;angular#`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–æ–ø–∏–∫ `/cmd_vel`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–∏–Ω–µ–π–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å X –∏ —É–≥–ª–æ–≤—É—é Z

**–¢–æ–ø–∏–∫–∏:**
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è: `/cmd_vel` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–æ–ø–∏–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- –ü—É–±–ª–∏–∫—É–µ—Ç: `low_level/esp32_input` ‚Üí `low_level/serial/cmd`

### 3. `feedback_processor`
**–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–æ–≤**
- –ü–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `$data1;...;data13#`
- –ü—É–±–ª–∏–∫—É–µ—Ç –æ–¥–æ–º–µ—Ç—Ä–∏—é, IMU, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–∞–≥—Ä—É–∑–∫—É
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ TF2

**–ü—É–±–ª–∏–∫—É–µ–º—ã–µ —Ç–æ–ø–∏–∫–∏:**
- `/odom` - –æ–¥–æ–º–µ—Ç—Ä–∏—è
- `/imu/data` - –¥–∞–Ω–Ω—ã–µ –∏–Ω–µ—Ä—Ü–∏–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- `/sensors/wheel/{left,right}/temperature` - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–æ—Ç–æ—Ä–æ–≤
- `/sensors/wheel/{left,right}/voltage` - –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ
- `/sensors/wheel/{left,right}/load` - –Ω–∞–≥—Ä—É–∑–∫–∞
- `/sensors/wheel/{left,right}/position` - –ø–æ–∑–∏—Ü–∏—è –≤–∞–ª–∞

**TF —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏:**
- `odom` ‚Üí `base_link`
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∫–æ–ª–µ—Å

## üìã –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### –ò—Å—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (ROS ‚Üí –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
```
$linear_velocity;angular_velocity#
```
–ü—Ä–∏–º–µ—Ä: `$0.5;-0.3#`

### –í—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ‚Üí ROS)
```
$x_pos;y_pos;theta;vx;vth;left_pos;right_pos;left_load;right_load;left_temp;right_temp;left_volt;right_volt#
```

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞
```bash
cd ~/mirea_jetbots/low_level_driver_dynamixel/src
colcon build --packages-select serial_bridge_package
source install/setup.bash
```

### –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ —Å—Ç–µ–∫–∞
```bash
ros2 launch serial_bridge_package serial_bringup.launch.py
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
```bash
# –ú–æ—Å—Ç Serial-ROS
ros2 run serial_bridge_package serial_bridge_node

# –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –∫–æ–º–∞–Ω–¥
ros2 run serial_bridge_package twist_to_command

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏
ros2 run serial_bridge_package feedback_processor
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã serial_bridge_node:
- `port`: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/dev/ttyUSB0`)
- `baudrate`: —Å–∫–æ—Ä–æ—Å—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 115200)
- `timeout`: —Ç–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —Å–µ–∫)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã feedback_processor:
- `frame_id`: —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ–¥–æ–º–µ—Ç—Ä–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `odom`)
- `child_frame_id`: —Å–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ä–æ–±–æ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `base_link`)
- `left/right_wheel_frame_id`: —Å–∏—Å—Ç–µ–º—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–æ–ª–µ—Å

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ RViz

–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
ros2 run rviz2 rviz2 -d install/serial_bridge_package/share/serial_bridge_package/rviz/show_all_stats.rviz
```

**–û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:**
- –ü–æ–∑–∏—Ü–∏—è –∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è —Ä–æ–±–æ—Ç–∞ (Odometry)
- TF —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–æ–≤ (—á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏)

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ROS2 Humble –∏–ª–∏ –Ω–æ–≤–µ–µ
- Python 3.8+
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `pyserial`
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–º—É –ø–æ—Ä—Ç—É

## –õ–∏—Ü–µ–Ω–∑–∏—è

Copyright (c) 2025 –ê–ª–∏—Å–∞ –ó–µ–Ω–∏–Ω–∞ –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ì—Ä–∞—á–µ–≤ –†–¢–£ –ú–ò–†–≠–ê (–†–æ—Å—Å–∏—è)

–î–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ [–ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT](LICENSE).
–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤–∞—Ö –∏ —Ç–µ–∫—Å—Ç–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏.