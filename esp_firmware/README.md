# ESP32 Firmware for ROS2 Serial Bridge

–ü—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ ESP32, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–≤—è–∑—å —Å ROS2-—Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç. –†–µ–∞–ª–∏–∑—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è–º–∏, —Ä–∞—Å—á–µ—Ç –æ–¥–æ–º–µ—Ç—Ä–∏–∏ –∏ —Å–±–æ—Ä —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏.

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–ü—Ä–∏–µ–º –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `$linear;angular#`
- **–†–∞—Å—á–µ—Ç –∫–∏–Ω–µ–º–∞—Ç–∏–∫–∏** –¥–ª—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–≤–æ–¥–∞
- **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–æ–º–µ—Ç—Ä–∏–∏** (–ø–æ–∑–∏—Ü–∏—è X, Y, —É–≥–æ–ª –∫—É—Ä—Å–∞)
- **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏** –≤ —Ñ–æ—Ä–º–∞—Ç–µ `$data1;...;data13#`
- **–ê–≤—Ç–æ—Å—Ç–æ–ø** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–º–∞–Ω–¥ –±–æ–ª–µ–µ 5 —Å–µ–∫—É–Ω–¥

## üîß –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ–±–æ—Ç–∞
```cpp
const float l = 0.117;      // –ö–æ–ª–µ—Å–Ω–∞—è –±–∞–∑–∞ (–º)
const float r = 0.065/2;    // –†–∞–¥–∏—É—Å –∫–æ–ª–µ—Å–∞ (–º)
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤—è–∑–∏
```cpp
Serial.begin(115200);       // –°–∫–æ—Ä–æ—Å—Ç—å UART
const int dt = 10;          // –ü–µ—Ä–∏–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (–º—Å)
```

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (ROS2 ‚Üí ESP32)
```
$linear_velocity;angular_velocity#
```
- `linear_velocity` - –ª–∏–Ω–µ–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)
- `angular_velocity` - —É–≥–ª–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ä–∞–¥/—Å)

**–ü—Ä–∏–º–µ—Ä:** `$0.5;-0.3#`

### –ò—Å—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ (ESP32 ‚Üí ROS2)
```
$x_pos;y_pos;theta;vx;vth;#
```

**–ü–æ–ª—è –¥–∞–Ω–Ω—ã—Ö:**
1. `x_pos` - –ø–æ–∑–∏—Ü–∏—è –ø–æ X (–º)
2. `y_pos` - –ø–æ–∑–∏—Ü–∏—è –ø–æ Y (–º) 
3. `theta` - —É–≥–æ–ª –∫—É—Ä—Å–∞ (—Ä–∞–¥)
4. `vx` - —Ä–µ–∞–ª—å–Ω–∞—è –ª–∏–Ω–µ–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–º/—Å)
5. `vth` - —Ä–µ–∞–ª—å–Ω–∞—è —É–≥–ª–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (—Ä–∞–¥/—Å)


## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
1. **–ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π –∏ —É–≥–ª–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
2. **–ö–∏–Ω–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** - —Ä–∞—Å—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–µ–π –∫–æ–ª–µ—Å:
   ```cpp
   target_speed_left = xl - zw * l / 2;
   target_speed_right = xl + zw * l / 2;
   ```
3. **–ù–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–µ–π** - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-0.8, 0.8]

### –†–∞—Å—á–µ—Ç –æ–¥–æ–º–µ—Ç—Ä–∏–∏
1. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏**:
   ```cpp
   linear_vel_x = (real_speed_right + real_speed_left) * _obrat * 2 * Pi * r / 2;
   ```
2. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏**:
   ```cpp
   angular_vel_z = (real_speed_right - real_speed_left) * _obrat * 2 * Pi * r / l;
   ```
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏**:
   ```cpp
   x_pos_ += linear_vel_x * cos(heading_) * dt/1000;
   y_pos_ += linear_vel_x * sin(heading_) * dt/1000;
   heading_ += angular_vel_z * dt/1000;
   ```

### –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–¢–∞–π–º–∞—É—Ç –∫–æ–º–∞–Ω–¥** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –±–µ–∑ –∫–æ–º–∞–Ω–¥
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä—å –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
```cpp
float R = 1/3.5;        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–∞–≤–æ–≥–æ –¥–≤–∏–≥–∞—Ç–µ–ª—è
float L = 1/3.5;        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –ª–µ–≤–æ–≥–æ –¥–≤–∏–≥–∞—Ç–µ–ª—è  
float _obrat = 3.5;     // –û–±—Ä–∞—Ç–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
```

### –¢–∞–π–º–∏–Ω–≥–∏
```cpp
const int dt = 10;                         // –ü–µ—Ä–∏–æ–¥ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ (–º—Å)
const unsigned im_timer_timeout = 5000;    // –¢–∞–π–º–∞—É—Ç –∞–≤—Ç–æ—Å—Ç–æ–ø–∞ (–º—Å)
```

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –î–≤–∏–≥–∞—Ç–µ–ª–∏ —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ (–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–∏–Ω–∞–º)
- –î–∞—Ç—á–∏–∫–∏ —ç–Ω–∫–æ–¥–µ—Ä–æ–≤ (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ–¥–æ–º–µ—Ç—Ä–∏–∏)
- –î–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∏–Ω–æ–≤
```cpp
#define LED_PIN 13  // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç—ã
// –î–æ–±–∞–≤–∏—Ç—å –ø–∏–Ω—ã –¥–ª—è –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π –∏ –¥–∞—Ç—á–∏–∫–æ–≤
```

## üöÄ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Arduino IDE –∏–ª–∏ PlatformIO
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏: Arduino, Wire, math.h

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ ESP32 –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –ø–ª–∞—Ç—É –≤ —Å—Ä–µ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ—Ä—Ç–∞ 115200 –±–æ–¥
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø—Ä–æ—à–∏–≤–∫—É
5. –û—Ç–∫—Ä–æ–π—Ç–µ Serial Monitor –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Serial Monitor
–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞:
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥: `$0.5;0.0#`
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –ò–Ω–¥–∏–∫–∞—Ü–∏—è
- –°–≤–µ—Ç–æ–¥–∏–æ–¥ –Ω–∞ –ø–∏–Ω–µ 13 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∏–≥–∞–Ω–∏—è –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Å–≤—è–∑–∏

## üí° –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- ‚ùå **–≠–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —ç–Ω–∫–æ–¥–µ—Ä—ã –∏ —Å–µ–Ω—Å–æ—Ä—ã
- ‚ùå **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–µ–≥—É–ª—è—Ç–æ—Ä** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –ü–ò–î-—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —ç–Ω–∫–æ–¥–µ—Ä–æ–≤ –¥–ª—è —Ç–æ—á–Ω–æ–π –æ–¥–æ–º–µ—Ç—Ä–∏–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ü–ò–î-—Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–æ–≤ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –æ—à–∏–±–æ–∫

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
Copyright (c) 2025 –ê–ª–∏—Å–∞ –ó–µ–Ω–∏–Ω–∞ –∏ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ì—Ä–∞—á–µ–≤ –†–¢–£ –ú–ò–†–≠–ê (–†–æ—Å—Å–∏—è)

–î–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ [–ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT](LICENSE).
–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å–≤–æ–±–æ–¥–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤–∞—Ö –∏ —Ç–µ–∫—Å—Ç–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏.